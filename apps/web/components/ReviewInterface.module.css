/* Main Container */
.pageContainer {
    display: flex;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    background: var(--bg-0);
    color: var(--text-0);
    /* --sidebar-width is now set dynamically in TSX */
}

.mainArea {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-width: 0;
}

/* Header */
.header {
    height: 60px;
    border-bottom: 1px solid var(--border-0);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 var(--s-6);
    background: var(--bg-1);
    z-index: 50;
}

.brand {
    font-weight: 700;
    font-size: 1.25rem;
    color: var(--text-0);
    letter-spacing: -0.02em;
}

.headerActions {
    display: flex;
    align-items: center;
    gap: var(--s-4);
}

/* Preview Area */
.previewContainer {
    flex: 1;
    position: relative;
    background: #111;
    /* Dark background to frame the centered iframe */
    overflow: hidden;
    display: flex;
    justify-content: center;
    /* Center the iframe when sidebar is closed */
    align-items: flex-start;
    /* Default alignment */
}

.viewport {
    position: relative;
    width: 100%;
    height: 100%;
    /* Transition for smooth window resizing, but instant for sidebar toggle? 
       Actually, sidebar toggle is animated. We want viewport to STAY same width.
       If sidebar animates, the "available space" grows. 
       If viewport width is calc(100vw - 380px), it is Constant.
       So it shouldn't animate width.
    */
    box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
    background: #fff;
}

.iframe {
    width: 100%;
    height: 100%;
    border: none;
    display: block;
}

/* Desktop: Stable Width Logic */
@media (min-width: 769px) {
    .viewport {
        /* Fixed responsive width: window - sidebar */
        width: calc(100vw - var(--sidebar-width));
        max-width: 100%;
    }
}

/* Overlay */
.overlay {
    position: absolute;
    /* Match the calculated width and centering of the iframe */
    width: 100%;
    height: 100%;
    /* We need to be careful here: The overlay is absolute relative to previewContainer. 
       If iframe is centered with a specific width, the overlay must match it. 
       Actually, standard absolute inset:0 covers the CONTAINER.
       But we want the pins to align with the IFRAME.
    */
    inset: 0;
    pointer-events: none;
    z-index: 100;

    /* Center content within overlay to match iframe centering */
    display: flex;
    justify-content: center;
}

/* Wrapper for pins to match iframe dimensions */
/* We'll adding a pseudo-element or wrapper logic isn't easy in pure CSS for existing pins.
   However, since the iframe is just centered, we can leave overlay as inset:0 
   and rely on the pins being positioned relative to the DOCUMENT coordinates ??
   Wait, the pin coordinates are relative to the DOCUMENT inside the iframe?
   No, previously we positioned them relative to the `overlay`.
 */

.sidebar {
    width: var(--sidebar-width);
    /* Slightly wider for comfort */
    border-left: 1px solid var(--border-0);
    background: var(--bg-1);
    display: flex;
    flex-direction: column;
    z-index: 50;
    transition: width 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    overflow-y: auto;
    overflow-x: hidden;
}

.sidebarCollapsed {
    width: 0;
    border-left: none;
    visibility: hidden;
}

.sidebarHeader {
    padding: var(--s-6);
    /* Increased padding */
    border-bottom: 1px solid var(--border-0);
    display: flex;
    flex-direction: column;
    gap: var(--s-4);
    /* Increased gap */
}

/* Toggle Group (Tabs) */
.toggleGroup {
    display: flex;
    background: rgba(255, 255, 255, 0.03);
    padding: 4px;
    border-radius: var(--r-md);
    border: 1px solid var(--border-0);
}

.toggleTab {
    flex: 1;
    padding: var(--s-2) 0;
    text-align: center;
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--text-1);
    border-radius: 6px;
    transition: all var(--dur-1) var(--ease);
    border: none;
    background: transparent;
    cursor: pointer;
}

.toggleTab:hover {
    color: var(--text-0);
}

.toggleTabActive {
    background: var(--bg-2);
    color: var(--text-0);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    font-weight: 600;
}

.commentList {
    padding: var(--s-6);
    /* Increased padding */
    display: flex;
    flex-direction: column;
    gap: var(--s-4);
    /* Increased gap */
}

/* Comment Cards */
.commentCard {
    background: var(--bg-2);
    /* Deeper background for contrast */
    border: 1px solid var(--border-0);
    border-radius: var(--r-md);
    padding: var(--s-4);
    font-size: 0.9rem;
    cursor: pointer;
    transition: all var(--dur-2) var(--ease);
    position: relative;
    height: auto;
}

.commentCard:hover {
    border-color: rgba(255, 255, 255, 0.15);
    transform: translateY(-2px);
    box-shadow: var(--shadow-1);
}

.cardActive {
    border-left: 3px solid var(--accent-0);
    background: linear-gradient(90deg, rgba(0, 243, 255, 0.03) 0%, transparent 100%);
}

.commentHeader {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--s-2);
}

.commentIndex {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-1);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
}

.cardActive .commentIndex {
    background: var(--accent-0);
    color: #000;
}

.commentStatus {
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    padding: 2px 8px;
    border-radius: 4px;
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-1);
    letter-spacing: 0.03em;
}

.commentCard:hover .commentStatus {
    background: rgba(255, 255, 255, 0.1);
}

.message {
    color: var(--text-0);
    line-height: 1.6;
    font-size: 0.95rem;
    white-space: pre-wrap;
    overflow-wrap: break-word;
    word-break: break-word;
}

.meta {
    margin-top: var(--s-3);
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.75rem;
    color: var(--text-1);
    padding-top: var(--s-2);
    border-top: 1px solid rgba(255, 255, 255, 0.03);
}

.emptyState {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: var(--text-1);
    margin-top: var(--s-8);
    background: transparent;
    padding: var(--s-4);
    border: 1px dashed var(--border-0);
    border-radius: var(--r-md);
}

.emptyStateIcon {
    font-size: 1.5rem;
    margin-bottom: var(--s-2);
    opacity: 0.5;
}

.emptyStateTitle {
    font-weight: 600;
    color: var(--text-0);
    margin-bottom: var(--s-1);
}

.emptyStateDesc {
    font-size: 0.85rem;
    max-width: 200px;
    line-height: 1.4;
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
    .pageContainer {
        flex-direction: column;
    }

    .sidebar {
        position: fixed;
        inset: 0;
        width: 100%;
        height: 100%;
        z-index: 900;
        border-left: none;
        transform: translateY(100%);
        transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        padding-top: 60px;
        /* Space for a potential close button or header overlay */
    }

    .sidebarOpen {
        transform: translateY(0);
    }

    .mainArea {
        width: 100%;
        height: 100%;
        max-height: 100vh;
    }
}

/* Popover */
.popover {
    position: absolute;
    width: 320px;
    background: #111;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    z-index: 200;
    display: flex;
    flex-direction: column;
    gap: 10px;
    animation: fadeIn 0.1s ease-out;
}

.popover textarea {
    width: 100%;
    min-height: 80px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 10px;
    color: #fff;
    font-size: 14px;
    resize: none;
    outline: none;
    font-family: inherit;
}

.popover textarea:focus {
    border-color: var(--accent-0);
    background: rgba(255, 255, 255, 0.08);
}

.popoverActions {
    display: flex;
    justify-content: flex-end;
    gap: 8px;
}

/* Reusing global btn classes, but ensuring visibility in popover */
.popoverActions button {
    font-size: 13px;
    font-weight: 500;
}